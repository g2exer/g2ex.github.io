<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Blockchain,Fabric,Docker,Golang,Nodejs,">





  <link rel="alternate" href="/atom.xml" title="G2EX" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0">






<meta name="description" content="0x00 介绍目前 Fabric 1.0 部署还是比较繁琐，环境搭建过程需要安装的和配置的东西较多，而且容易出错。 Fabric 从 1.0 beta 版到 1.0 正式版，官方文档也更新了不少。网络上很多中文资料是翻译的较早的官方文档，所以学习 Fabric 一定要参考最新的官方文档。官方文档中提供了一个名为 fabcar 智能合约的演示，指导我们从构建第一个网络到构建第一个应用。不过这一路从配">
<meta name="keywords" content="Blockchain,Fabric,Docker,Golang,Nodejs">
<meta property="og:type" content="article">
<meta property="og:title" content="Fabric 1.0 填坑指南">
<meta property="og:url" content="https://g2ex.top/2017/11/11/fabric-1.0-guide/index.html">
<meta property="og:site_name" content="G2EX">
<meta property="og:description" content="0x00 介绍目前 Fabric 1.0 部署还是比较繁琐，环境搭建过程需要安装的和配置的东西较多，而且容易出错。 Fabric 从 1.0 beta 版到 1.0 正式版，官方文档也更新了不少。网络上很多中文资料是翻译的较早的官方文档，所以学习 Fabric 一定要参考最新的官方文档。官方文档中提供了一个名为 fabcar 智能合约的演示，指导我们从构建第一个网络到构建第一个应用。不过这一路从配">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-11-25T02:09:19.688Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Fabric 1.0 填坑指南">
<meta name="twitter:description" content="0x00 介绍目前 Fabric 1.0 部署还是比较繁琐，环境搭建过程需要安装的和配置的东西较多，而且容易出错。 Fabric 从 1.0 beta 版到 1.0 正式版，官方文档也更新了不少。网络上很多中文资料是翻译的较早的官方文档，所以学习 Fabric 一定要参考最新的官方文档。官方文档中提供了一个名为 fabcar 智能合约的演示，指导我们从构建第一个网络到构建第一个应用。不过这一路从配">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://g2ex.top/2017/11/11/fabric-1.0-guide/">





  <title> Fabric 1.0 填坑指南 | G2EX </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?0056c67deccbe6617d059b40d352195f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">G2EX</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://g2ex.top/2017/11/11/fabric-1.0-guide/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Yaming Gong">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="G2EX">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="G2EX" src>
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Fabric 1.0 填坑指南
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-11T22:48:00+00:00">
                2017-11-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/11/11/fabric-1.0-guide/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/11/11/fabric-1.0-guide/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="0x00-介绍"><a href="#0x00-介绍" class="headerlink" title="0x00 介绍"></a>0x00 介绍</h2><p>目前 Fabric 1.0 部署还是比较繁琐，环境搭建过程需要安装的和配置的东西较多，而且容易出错。</p>
<p>Fabric 从 1.0 beta 版到 1.0 正式版，官方文档也更新了不少。网络上很多中文资料是翻译的较早的官方文档，所以学习 Fabric 一定要参考最新的<a href="https://hyperledger-fabric.readthedocs.io" target="_blank" rel="noopener">官方文档</a>。官方文档中提供了一个名为 <a href="https://github.com/hyperledger/fabric-samples" target="_blank" rel="noopener">fabcar</a> 智能合约的演示，指导我们从构建第一个网络到构建第一个应用。不过这一路从配置环境到合约演示，尤其在 Chinternet 的网络环境下，大大小小的坑有不少。正是因为这些原因，应该有一个对 Fabric 1.0 部署到合约演示的指导性文档，这也是本文的写作目的。初学者请以官方文档为主要学习材料，本文仅作为官方文档之外的参考指导。</p>
<p>本文使用 Fabric 1.0.4，基于 Ubuntu 16.04 x64，总结 Fabric 部署过程和 fabcar 链码演示过程中需要注意的地方，解释某些步骤使得知其然又能知其所以然，同时给出自己的最佳实践。</p>
<hr>
<h2 id="0x01-部署的先决条件"><a href="#0x01-部署的先决条件" class="headerlink" title="0x01 部署的先决条件"></a>0x01 部署的先决条件</h2><h3 id="1-Docker-必需"><a href="#1-Docker-必需" class="headerlink" title="1) Docker [必需]"></a>1) Docker [必需]</h3><p>文档中 <a href="https://hyperledger-fabric.readthedocs.io/en/release/prereqs.html#prerequisites" target="_blank" rel="noopener">Prerequisites</a> 一节，说的是运行 Fabric 的先决条件。因为 Fabric 基于 docker 部署，所以 docker 和 docker-compose 是必须的。同时对它们的版本有要求：</p>
<blockquote>
<p>docker - 17.03.0-ce +<br>docker-compose - 1.8 +</p>
</blockquote>
<h4 id="安装-Docker-CE"><a href="#安装-Docker-CE" class="headerlink" title="安装 Docker CE"></a>安装 Docker CE</h4><p>今年 3 月之后，Docker 17+ 分化成了 CE 社区版和 EE 企业版。和大多数一样，社区版免费使用。在 Ubuntu x64 里安装社区版<strong>推荐使用官方仓库安装</strong>，参考 <a href="https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/#set-up-the-repository" target="_blank" rel="noopener">https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/#set-up-the-repository</a></p>
<p>总结一下，命令分别如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 安装依赖</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    software-properties-common</span><br><span class="line"></span><br><span class="line"># 添加 Docker 官方 GPG key</span><br><span class="line">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line"></span><br><span class="line"># 本地添加 Docker 更新源地址</span><br><span class="line">$ sudo add-apt-repository \</span><br><span class="line">   &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span><br><span class="line">   $(lsb_release -cs) \</span><br><span class="line">   stable&quot;</span><br><span class="line"></span><br><span class="line"># 安装 Docker CE</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install docker-ce</span><br><span class="line"></span><br><span class="line"># 通过查看版本测试是否安装成功</span><br><span class="line">$ docker --version</span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p><strong>给 Docker 加速</strong></p>
</blockquote>
<p>如果在国内使用 Docker，推荐使用阿里云的 Docker 加速。登陆阿里云容器镜像服务 <a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="noopener">https://cr.console.aliyun.com/#/accelerator</a> 在加速器页分配了自己的加速器地址。使用以下命令把加速地址写入 Docker 配置文件并重启服务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&apos;EOF&apos;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://你的加速地址.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p><strong>Docker 权限问题</strong></p>
</blockquote>
<p>安装完成后，如果用普通用户执行 docker 命令，会出现权限问题，需要用 sudo 命令运行。但是出于安全考虑，更好的做法是将需要使用 docker 的用户加入 docker 用户组。命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">建立 docker 组：</span><br><span class="line">$ sudo groupadd docker</span><br><span class="line"></span><br><span class="line">将当前用户加入 docker 组：</span><br><span class="line">$ sudo usermod -aG docker $USER</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="安装-docker-compose"><a href="#安装-docker-compose" class="headerlink" title="安装 docker-compose"></a>安装 docker-compose</h4><p>因为 Fabric 容器使用 docker-compose 编排，所以 docker-compose 是必须的。安装方法参考 <a href="https://docs.docker.com/compose/install/#prerequisites" target="_blank" rel="noopener">https://docs.docker.com/compose/install/#prerequisites</a></p>
<p>总结一下，命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 当前 docker-compose 最新版是 1.17.0</span><br><span class="line">$ sudo curl -L https://github.com/docker/compose/releases/download/1.17.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"># 添加可执行权限</span><br><span class="line">$ sudo chmod +x /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"># 通过查看版本测试是否安装成功</span><br><span class="line">$ docker-compose --version</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-Golang-非必需"><a href="#2-Golang-非必需" class="headerlink" title="2) Golang [非必需]"></a>2) Golang [非必需]</h3><p>虽然 Prerequisites 中提到了 Golang，但 Golang 并不是必须的。<br>如果是把现成的链码部署到 Fabirc 上，比如 <a href="https://hyperledger-fabric.readthedocs.io/en/release/samples.html" target="_blank" rel="noopener">fabric-samples</a> 中的 fabcar demo 示例，向 Fabric 网络安装和实例化 fabcar 链码的过程是在 docker 容器 cli 中执行的，容器 cli 中已经配置好了 Golang 环境。<br>如果你想在本地编写自己的链码，验证是否能通过编译，则需要本地配置 Golang 环境，版本要求 1.7 +。</p>
<p>配置 Golang 环境参考 <a href="https://golang.org/doc/install" target="_blank" rel="noopener">https://golang.org/doc/install</a></p>
<p>总结一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 下载安装包后，root 权限解压至 /usr/local 下：</span><br><span class="line">$ sudo tar -C /usr/local -xzf go$VERSION.$OS-$ARCH.tar.gz</span><br><span class="line"></span><br><span class="line"># 编辑 /etc/profile 或 $HOME/.profile，在文件最后添加环境变量：</span><br><span class="line">export PATH=$PATH:/usr/local/go/bin</span><br><span class="line"></span><br><span class="line"># 编辑 $HOME/.profile 或者 $HOME/.bashrc，添加 go 工作目录环境变量 GOPATH：</span><br><span class="line">export GOPATH=$HOME/workspace/gopath</span><br><span class="line"></span><br><span class="line"># 通过查看版本测试是否安装成功</span><br><span class="line">$ go version</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3-Node-JS-非必需"><a href="#3-Node-JS-非必需" class="headerlink" title="3) Node.JS [非必需]"></a>3) Node.JS [非必需]</h3><p>Node.JS 也不是必需的。<br>Fabric 1.0 提供了 SDK，它封装了与 Fabric 区块链交互的 API，目前功能最全官方最推荐的是 Node.js 版本的 SDK。所以，如果要简单演示 fabcar demo 示例，或者要开发上层应用，需要 Node.js 环境。</p>
<blockquote>
<p>目前对 Node.js 的版本要求如下：<br>Node.js - version 6.9.x +（但不支持 7.x）<br>npm - @3.10.10</p>
</blockquote>
<p><strong>需要注意的坑</strong></p>
<p>Node.js 官网最新的 LTS 版本已经从 6.x 升级到了 8.x。（2017.11.9）Ubuntu 仓库默认的 Nodejs 版本太古老，因此强烈推荐使用官网的 package manager 方法安装 Node.js。参考 <a href="https://nodejs.org/en/download/package-manager/" target="_blank" rel="noopener">https://nodejs.org/en/download/package-manager/</a></p>
<p>总结如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -</span><br><span class="line">$ sudo apt-get install -y nodejs</span><br><span class="line">$ npm version</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>npm加速</strong></p>
</blockquote>
<p>国内使用 npm 非常不稳定，推荐使用淘宝 NPM 镜像加速。<br>推荐使用淘宝定制的 cnpm (gzip 压缩支持) 命令行工具代替默认的 npm：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>以后用到 <code>npm install</code> 命令的地方，直接用 <code>cnpm install</code> 代替即可。</p>
<p>至此，基本上所需要配置的环境已经安装好了，可以进入下一步，根据你的需要下载所需的 docker 镜像，运行示例。</p>
<hr>
<h2 id="0x02-下载-Docker-镜像"><a href="#0x02-下载-Docker-镜像" class="headerlink" title="0x02 下载 Docker 镜像"></a>0x02 下载 Docker 镜像</h2><p>官方文档里提供了 Fabric Samples <a href="https://hyperledger-fabric.readthedocs.io/en/release/samples.html" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release/samples.html</a><br>该示例的源码在 Github 上 <a href="https://github.com/hyperledger/fabric-samples" target="_blank" rel="noopener">https://github.com/hyperledger/fabric-samples</a></p>
<p>fabric-samples 项目里包括了我们接下来要演示的 fabcar 链码。这里要用到一个脚本去下载所需 Docker 镜像和所需工具。为了把所需工具下载到 fabric-samples 项目里，需要先把该项目 clone 到本地，再在项目目录里下载并执行脚本。</p>
<p>把项目 Clone 项目到本地：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/hyperledger/fabric-samples.git</span><br></pre></td></tr></table></figure>

<p>接下来在项目目录里执行下面命令，会获取 <code>bootstrap-1.0.4.sh</code> 脚本并运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd fabric-samples</span><br><span class="line">$ curl -sSL https://raw.githubusercontent.com/hyperledger/fabric/release/scripts/bootstrap-1.0.4.sh | bash</span><br></pre></td></tr></table></figure>

<p><code>bootstrap-1.0.4.sh</code> 会下载 1.0.4 版本的 Docker 镜像 <code>peer</code> <code>orderer</code> <code>couchdb</code> <code>ccenv</code> <code>javaenv</code> <code>kafka</code> <code>zookeeper</code> <code>tools</code> 并标记成 <code>latest</code>。
同时会下载 <a href="https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/linux-amd64-1.0.4/hyperledger-fabric-linux-amd64-1.0.4.tar.gz" target="_blank" rel="noopener">hyperledger-fabric-linux-amd64-1.0.4.tar.gz</a> 压缩包（工具包），并解压缩到当前的 <code>bin</code> 目录下。<br>脚本运行结束后，可以看到项目目录中多出一个 bin 目录，里有 5 个可执行文件和 2 个脚本：<code>configtxgen</code> <code>configtxlator</code> <code>cryptogen</code> <code>orderer</code> <code>peer</code> <code>get-byfn.sh</code> <code>get-docker-images.sh</code>。这些文件在后续搭建网络、生成配置文件和操作链码的时候会用到。</p>
<p>Docker 镜像下载完成后应该是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ docker images | grep hyperledger*</span><br><span class="line">hyperledger/fabric-ca          latest              8e691b3509bf        8 days ago          238MB</span><br><span class="line">hyperledger/fabric-ca          x86_64-1.0.4        8e691b3509bf        8 days ago          238MB</span><br><span class="line">hyperledger/fabric-tools       latest              6051774928a6        8 days ago          1.33GB</span><br><span class="line">hyperledger/fabric-tools       x86_64-1.0.4        6051774928a6        8 days ago          1.33GB</span><br><span class="line">hyperledger/fabric-couchdb     latest              cf24b91dfeb1        8 days ago          1.5GB</span><br><span class="line">hyperledger/fabric-couchdb     x86_64-1.0.4        cf24b91dfeb1        8 days ago          1.5GB</span><br><span class="line">hyperledger/fabric-kafka       latest              7a9d6f3c4a7c        8 days ago          1.29GB</span><br><span class="line">hyperledger/fabric-kafka       x86_64-1.0.4        7a9d6f3c4a7c        8 days ago          1.29GB</span><br><span class="line">hyperledger/fabric-zookeeper   latest              53c4a0d95fd4        8 days ago          1.3GB</span><br><span class="line">hyperledger/fabric-zookeeper   x86_64-1.0.4        53c4a0d95fd4        8 days ago          1.3GB</span><br><span class="line">hyperledger/fabric-orderer     latest              b17741e7b036        8 days ago          151MB</span><br><span class="line">hyperledger/fabric-orderer     x86_64-1.0.4        b17741e7b036        8 days ago          151MB</span><br><span class="line">hyperledger/fabric-peer        latest              1ce935adc397        8 days ago          154MB</span><br><span class="line">hyperledger/fabric-peer        x86_64-1.0.4        1ce935adc397        8 days ago          154MB</span><br><span class="line">hyperledger/fabric-javaenv     latest              a517b70135c7        8 days ago          1.41GB</span><br><span class="line">hyperledger/fabric-javaenv     x86_64-1.0.4        a517b70135c7        8 days ago          1.41GB</span><br><span class="line">hyperledger/fabric-ccenv       latest              856061b1fed7        8 days ago          1.28GB</span><br><span class="line">hyperledger/fabric-ccenv       x86_64-1.0.4        856061b1fed7        8 days ago          1.28GB</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="0x03-演示-fabcar-Demo"><a href="#0x03-演示-fabcar-Demo" class="headerlink" title="0x03 演示 fabcar Demo"></a>0x03 演示 fabcar Demo</h2><p>参考官方文档的<a href="https://hyperledger-fabric.readthedocs.io/en/release/write_first_app.html" target="_blank" rel="noopener">《构建你的第一个应用》</a>去操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 进入 fabcar 目录</span><br><span class="line">$ cd fabric-samples/fabcar</span><br><span class="line"># 安装依赖，因为用的是 Node.js SDK</span><br><span class="line">$ cnpm install</span><br><span class="line"># 启动 Fabric 网络：1 Peer + 1 orderer + ca + couchdb + cli</span><br><span class="line">$ ./startFabric.sh</span><br></pre></td></tr></table></figure>

<p>如果前面你的配置没问题，运行 fabcar 目录下的 startFabric.sh 脚本后，就可以启动一个简单的 Fabric 网络了，网络由 <code>1 Peer</code> + <code>1 orderer</code> + <code>ca</code> + <code>couchdb</code> + <code>cli</code> 组成。</p>
<p>之后，就可以按照官方文档中的步骤，用 <code>node enrollAdmin.js</code> <code>node registerUser.js</code> <code>node invoke.js</code> <code>node query.js</code> 与 fabcar 链码交互了。</p>
<blockquote>
<p><strong>疑惑1</strong><br>Fabric 网络是怎么建立起来的？</p>
</blockquote>
<p>具体参见 <a href="https://github.com/hyperledger/fabric-samples/blob/release/fabcar/startFabric.sh" target="_blank" rel="noopener">startFabric.sh</a> 脚本，可以看到它启动了 fabric-samples/basic-network 目录下的 <a href="https://github.com/hyperledger/fabric-samples/blob/release/basic-network/start.sh" target="_blank" rel="noopener">start.sh</a>，该脚本里执行了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-compose.yml up -d ca.example.com orderer.example.com peer0.org1.example.com couchdb</span><br></pre></td></tr></table></figure>

<p>Fabric 网络就在这个 <a href="https://github.com/hyperledger/fabric-samples/blob/release/basic-network/docker-compose.yml" target="_blank" rel="noopener">docker-compose.yml</a> 中定义好了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CA 容器 - ca.example.com</span><br><span class="line">orderer 容器 - orderer.example.com</span><br><span class="line">peer 容器 - peer0.org1.example.com</span><br><span class="line">couchdb 容器 - couchdb</span><br><span class="line">cli 容器 - cli</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>疑惑2</strong><br>fabcar 链码放在了哪里？以后我们自己的合约又怎么部署 Fabric 网络上？</p>
</blockquote>
<p>作为开发者，我们要通过客户端 —— cli 容器——与 Fabric 网络交互。在部署链码时，会通过 cli 客户端把 cli 中的 fabcar 链码安装到 peer0 上。</p>
<p>在 fabric-samples 项目里，有一个 <code>chaincode</code> 目录，fabcar 就放在了这个目录下。在定义 Fabric 网络的 <code>basic-network/docker-compose.yml</code> 中，可以看到以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">    ...</span><br><span class="line">    cli:</span><br><span class="line">        ...</span><br><span class="line">        volumes:</span><br><span class="line">            ...</span><br><span class="line">            - ./../chaincode/:/opt/gopath/src/github.com/</span><br><span class="line">            ...</span><br></pre></td></tr></table></figure>

<p>cli 容器把项目中的 <code>chaincode</code> 目录映射到了容器的 <code>/opt/gopath/src/github.com/</code> 路径下。我们可以进入 cli 容器验证一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker exec -it cli bash</span><br><span class="line"># ls /opt/gopath/src/github.com/</span><br><span class="line">chaincode_example02  fabcar  hyperledger  marbles02  sacc</span><br></pre></td></tr></table></figure>

<p>当 fabcar/startFabric.sh 脚本执行到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -e &quot;CORE_PEER_LOCALMSPID=Org1MSP&quot; -e &quot;CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp&quot; cli peer chaincode install -n fabcar -v 1.0 -p github.com/fabcar</span><br></pre></td></tr></table></figure>

<p>会把 cli 中 <code>$GOPATH</code> 路径下的 <code>github.com/fabcar</code> 链码安装到 Fabric 网络中。</p>
<p>所以，对于我们自己开发的链码，也可以把链码放到项目的 chaincode 目录下，同时链码目录映射到 cli 容器中。修改 startFabric.sh 中的参数，把我们自己的链码安装和实例化。</p>
<hr>
<h2 id="0x04-其他说明"><a href="#0x04-其他说明" class="headerlink" title="0x04 其他说明"></a>0x04 其他说明</h2><p>说到用 Golang 开发链码，推荐 Visual Studio Code 编辑器。它自动推荐合适的扩展，对 Go 的支持很好。不过 VSC 在安装 Go 扩展的时候，因为墙的原因，往往会遇到下面的问题：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Installing github.com/nsf/gocode SUCCEEDED</span><br><span class="line">Installing github.com/uudashr/gopkgs/cmd/gopkgs SUCCEEDED</span><br><span class="line">Installing github.com/ramya-rao-a/go-outline FAILED</span><br><span class="line">Installing github.com/acroca/go-symbols FAILED</span><br><span class="line">Installing golang.org/x/tools/cmd/guru FAILED</span><br><span class="line">Installing golang.org/x/tools/cmd/gorename FAILED</span><br><span class="line">Installing github.com/fatih/gomodifytags SUCCEEDED</span><br><span class="line">Installing github.com/josharian/impl FAILED</span><br><span class="line">Installing github.com/rogpeppe/godef SUCCEEDED</span><br><span class="line">Installing sourcegraph.com/sqs/goreturns FAILED</span><br><span class="line">Installing github.com/golang/lint/golint FAILED</span><br><span class="line">Installing github.com/cweill/gotests/... FAILED</span><br><span class="line">Installing github.com/derekparker/delve/cmd/dlv SUCCEEDED</span><br></pre></td></tr></table></figure>

<p>解决办法是，给 go 和 git 设置代理。之所以要给 git 也设置代理，是因为安装 go 扩展用到的 <code>go get</code> 命令会先用 git 去仓库获取。Go 目前只支持 http/https 代理，git 可以设置 http/https 和 SOCKS 代理。代理的设置，可以参考 <a href="https://g2ex.github.io/2017/10/22/windows-linux-git-proxy-cmd" target="_blank" rel="noopener">https://g2ex.github.io/2017/10/22/windows-linux-git-proxy-cmd</a></p>
<p>简言之，在 Ubuntu 里使用以下命令为当前终端和 git 设置代理，然后手动执行 <code>go get -u -v github.com/ramya-rao-a/go-outline</code> 等命令给 VSC 安装扩展。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 当前终端设置 http/https 代理以供 go get 命令使用</span><br><span class="line">$ export http_proxy=http://127.0.0.1:8118</span><br><span class="line">$ export https_proxy=http://127.0.0.1:8118</span><br><span class="line"></span><br><span class="line"># Git 设置 http/https 代理</span><br><span class="line">git config --global http.proxy http://127.0.0.1:8118</span><br><span class="line">git config --global https.proxy http://127.0.0.1:8118</span><br><span class="line"># 或 Git 设置 SOCKS 代理</span><br><span class="line">git config --global http.proxy socks5://127.0.0.1:1080</span><br><span class="line">git config --global https.proxy socks5://127.0.0.1:1080</span><br></pre></td></tr></table></figure>

<hr>
<p>以上是我在实际操作中遇到过的一些问题和解决方法。随着 Fabric 和官方文档的更新，本文也会过时，不过还是希望能对学习 Fabric 的朋友们有所帮助。</p>
<hr>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Blockchain/" rel="tag"># Blockchain</a>
          
            <a href="/tags/Fabric/" rel="tag"># Fabric</a>
          
            <a href="/tags/Docker/" rel="tag"># Docker</a>
          
            <a href="/tags/Golang/" rel="tag"># Golang</a>
          
            <a href="/tags/Nodejs/" rel="tag"># Nodejs</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/10/22/windows-linux-git-proxy-cmd/" rel="next" title="Win/Linux 命令行、终端和 Git 代理设置">
                <i class="fa fa-chevron-left"></i> Win/Linux 命令行、终端和 Git 代理设置
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/01/21/linux-terminal-zsh-notes/" rel="prev" title="终端折腾记">
                终端折腾记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/avatar.png" alt="Yaming Gong">
          <p class="site-author-name" itemprop="name">Yaming Gong</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">63</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">102</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/gymgle" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/gymgle" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/773662567" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.flickr.com/photos/gymgle/" target="_blank" title="Flickr">
                  
                    <i class="fa fa-fw fa-flickr"></i>
                  
                  Flickr
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons">
            </a>
          </div>
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x00-介绍"><span class="nav-number">1.</span> <span class="nav-text">0x00 介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-部署的先决条件"><span class="nav-number">2.</span> <span class="nav-text">0x01 部署的先决条件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Docker-必需"><span class="nav-number">2.1.</span> <span class="nav-text">1) Docker [必需]</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装-Docker-CE"><span class="nav-number">2.1.1.</span> <span class="nav-text">安装 Docker CE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装-docker-compose"><span class="nav-number">2.1.2.</span> <span class="nav-text">安装 docker-compose</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Golang-非必需"><span class="nav-number">2.2.</span> <span class="nav-text">2) Golang [非必需]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Node-JS-非必需"><span class="nav-number">2.3.</span> <span class="nav-text">3) Node.JS [非必需]</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-下载-Docker-镜像"><span class="nav-number">3.</span> <span class="nav-text">0x02 下载 Docker 镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-演示-fabcar-Demo"><span class="nav-number">4.</span> <span class="nav-text">0x03 演示 fabcar Demo</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x04-其他说明"><span class="nav-number">5.</span> <span class="nav-text">0x04 其他说明</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2012 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yaming Gong</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'g2ex';
      var disqus_identifier = '2017/11/11/fabric-1.0-guide/';

      var disqus_title = "Fabric 1.0 填坑指南";


      function run_disqus_script(disqus_script) {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');

      
        var disqus_config = function () {
            this.page.url = disqus_url;
            this.page.identifier = disqus_identifier;
            this.page.title = disqus_title;
        };
        run_disqus_script('embed.js');
      

    </script>
  





  
  

  

  

  

  


</body>
</html>
